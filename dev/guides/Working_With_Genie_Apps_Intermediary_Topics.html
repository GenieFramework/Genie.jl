<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Working With Genie Apps: Intermediate Topics [WIP] · Genie - The Highly Productive Julia Web Framework</title><meta name="title" content="Working With Genie Apps: Intermediate Topics [WIP] · Genie - The Highly Productive Julia Web Framework"/><meta property="og:title" content="Working With Genie Apps: Intermediate Topics [WIP] · Genie - The Highly Productive Julia Web Framework"/><meta property="twitter:title" content="Working With Genie Apps: Intermediate Topics [WIP] · Genie - The Highly Productive Julia Web Framework"/><meta name="description" content="Documentation for Genie - The Highly Productive Julia Web Framework."/><meta property="og:description" content="Documentation for Genie - The Highly Productive Julia Web Framework."/><meta property="twitter:description" content="Documentation for Genie - The Highly Productive Julia Web Framework."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../index.html">Genie - The Highly Productive Julia Web Framework</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../index.html">Home</a></li><li><span class="tocitem">Guides</span><ul><li><a class="tocitem" href="Migrating_from_v4_to_v5.html">Migrating Genie v4 apps to Genie v5</a></li><li><a class="tocitem" href="Working_With_Genie_Apps.html">Working with Genie Apps</a></li><li class="is-active"><a class="tocitem" href="Working_With_Genie_Apps_Intermediary_Topics.html">Working With Genie Apps: Intermediate Topics [WIP]</a><ul class="internal"><li><a class="tocitem" href="#Handling-forms"><span>Handling forms</span></a></li><li><a class="tocitem" href="#Uploading-files"><span>Uploading files</span></a></li></ul></li><li><a class="tocitem" href="Interactive_environment.html">Using Genie in an interactive environment</a></li><li><a class="tocitem" href="Simple_API_backend.html">Developing an API backend</a></li><li><a class="tocitem" href="Genie_Plugins.html">Using Genie Plugins</a></li><li><a class="tocitem" href="Deploying_Genie_Apps_On_AWS.html">Deploying Genie Apps On AWS</a></li><li><a class="tocitem" href="Controlling_Load_Order_Of_Genie_Apps.html">Controlling Load Order of Genie Apps</a></li></ul></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../tutorials/1--Overview.html">Welcome to Genie</a></li><li><a class="tocitem" href="../tutorials/2--Installing_Genie.html">Installing Genie</a></li><li><a class="tocitem" href="../tutorials/3--Getting_Started.html">Getting started</a></li><li><a class="tocitem" href="../tutorials/4--Developing_Web_Services.html">Creating a web service</a></li><li><a class="tocitem" href="../tutorials/4-1--Developing_MVC_Web_Apps.html">Developing MVC web applications</a></li><li><a class="tocitem" href="../tutorials/5--Handling_Query_Params.html">Handling URI/query params</a></li><li><a class="tocitem" href="../tutorials/6--Working_with_POST_Payloads.html">Working with forms and POST payloads</a></li><li><a class="tocitem" href="../tutorials/7--Using_JSON_Payloads.html">Using JSON payloads</a></li><li><a class="tocitem" href="../tutorials/8--Handling_File_Uploads.html">Uploading files</a></li><li><a class="tocitem" href="../tutorials/9--Publishing_Your_Julia_Code_Online_With_Genie_Apps.html">Adding your libraries into Genie</a></li><li><a class="tocitem" href="../tutorials/10--Loading_Genie_Apps.html">Loading and starting Genie apps</a></li><li><a class="tocitem" href="../tutorials/11--Managing_External_Packages.html">Managing Genie app&#39;s dependencies</a></li><li><a class="tocitem" href="../tutorials/12--Advanced_Routing_Techniques.html">Advanced routing</a></li><li><a class="tocitem" href="../tutorials/13--Initializers.html">Auto-loading configuration code with initializers</a></li><li><a class="tocitem" href="../tutorials/14--The_Secrets_File.html">The secrets file</a></li><li><a class="tocitem" href="../tutorials/15--The_Lib_Folder.html">Auto-loading user libraries</a></li><li><a class="tocitem" href="../tutorials/16--Using_Genie_With_Docker.html">Using Genie with Docker</a></li><li><a class="tocitem" href="../tutorials/17--Working_with_Web_Sockets.html">Working with WebSockets</a></li><li><a class="tocitem" href="../tutorials/90--Deploying_With_Heroku_Buildpacks.html">Deploying to Heroku with Buildpacks</a></li><li><a class="tocitem" href="../tutorials/92--Deploying_Genie_Server_Apps_with_Nginx.html">Deploying to server with Nginx</a></li></ul></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="../API/assets.html">Assets</a></li><li><a class="tocitem" href="../API/commands.html">Commands</a></li><li><a class="tocitem" href="../API/configuration.html">Configuration</a></li><li><a class="tocitem" href="../API/cookies.html">Cookies</a></li><li><a class="tocitem" href="../API/encryption.html">Encryption</a></li><li><a class="tocitem" href="../API/exceptions.html">Exceptions</a></li><li><a class="tocitem" href="../API/filetemplates.html">FileTemplates</a></li><li><a class="tocitem" href="../API/generator.html">Generator</a></li><li><a class="tocitem" href="../API/genie.html">Genie</a></li><li><a class="tocitem" href="../API/headers.html">Headers</a></li><li><a class="tocitem" href="../API/httputils.html">HttpUtils</a></li><li><a class="tocitem" href="../API/input.html">Input</a></li><li><a class="tocitem" href="../API/loader.html">Loader</a></li><li><a class="tocitem" href="../API/logger.html">Logger</a></li><li><a class="tocitem" href="../API/renderer.html">Renderer</a></li><li><a class="tocitem" href="../API/renderer-html.html">HTML Renderer</a></li><li><a class="tocitem" href="../API/renderer-js.html">JS Renderer</a></li><li><a class="tocitem" href="../API/renderer-json.html">JSON Renderer</a></li><li><a class="tocitem" href="../API/requests.html">Requests</a></li><li><a class="tocitem" href="../API/responses.html">Responses</a></li><li><a class="tocitem" href="../API/router.html">Router</a></li><li><a class="tocitem" href="../API/secrets.html">Secrets</a></li><li><a class="tocitem" href="../API/server.html">Server</a></li><li><a class="tocitem" href="../API/toolbox.html">Toolbox</a></li><li><a class="tocitem" href="../API/util.html">Util</a></li><li><a class="tocitem" href="../API/watch.html">Watch</a></li><li><a class="tocitem" href="../API/webchannels.html">WebChannels</a></li><li><a class="tocitem" href="../API/webthreads.html">WebThreads</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Guides</a></li><li class="is-active"><a href="Working_With_Genie_Apps_Intermediary_Topics.html">Working With Genie Apps: Intermediate Topics [WIP]</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="Working_With_Genie_Apps_Intermediary_Topics.html">Working With Genie Apps: Intermediate Topics [WIP]</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/GenieFramework/Genie.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/GenieFramework/Genie.jl/blob/main/docs/src/guides/Working_With_Genie_Apps_Intermediary_Topics.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Working-With-Genie-Apps:-Intermediate-Topics"><a class="docs-heading-anchor" href="#Working-With-Genie-Apps:-Intermediate-Topics">Working With Genie Apps: Intermediate Topics</a><a id="Working-With-Genie-Apps:-Intermediate-Topics-1"></a><a class="docs-heading-anchor-permalink" href="#Working-With-Genie-Apps:-Intermediate-Topics" title="Permalink"></a></h1><p><strong>WARNING: THIS PAGE IS UNDER CONSTRUCTION – THE CONTENT IS USABLE BUT INCOMPLETE</strong></p><h2 id="Handling-forms"><a class="docs-heading-anchor" href="#Handling-forms">Handling forms</a><a id="Handling-forms-1"></a><a class="docs-heading-anchor-permalink" href="#Handling-forms" title="Permalink"></a></h2><p>Now, the problem is that Bill Gates reads – a lot! It would be much easier if we would allow our users to add a few books themselves, to give us a hand. But since, obviously, we&#39;re not going to give them access to our Julia REPL, we should setup a web page with a form. Let&#39;s do it.</p><p>We&#39;ll start by adding the new routes:</p><pre><code class="language-julia hljs"># routes.jl
route(&quot;/bgbooks/new&quot;, BooksController.new)
route(&quot;/bgbooks/create&quot;, BooksController.create, method = POST, named = :create_book)</code></pre><p>The first route will be used to display the page with the new book form. The second will be the target page for submitting our form - this page will accept the form&#39;s payload. Please note that it&#39;s configured to match <code>POST</code> requests and that we gave it a name. We&#39;ll use the name in our form so that Genie will dynamically generate the correct links to the corresponding URL (to avoid hard coding URLs). This way we&#39;ll make sure that our form will always submit to the right URL, even if we change the route (as long as we don&#39;t change the name).</p><p>Now, to add the methods in <code>BooksController</code>. Add these definition under the <code>billgatesbooks</code> function (make sure you add them in <code>BooksController</code>, not in <code>BooksController.API</code>):</p><pre><code class="language-julia hljs"># BooksController.jl
function new()
  html(:books, :new)
end

function create()
  # code here
end</code></pre><p>The <code>new</code> method should be clear: we&#39;ll just render a view file called <code>new</code>. As for <code>create</code>, for now it&#39;s just a placeholder.</p><p>Next, to add our view. Add a blank file called <code>new.jl.html</code> in <code>app/resources/books/views</code>. Using Julia:</p><pre><code class="language-julia hljs">julia&gt; touch(&quot;app/resources/books/views/new.jl.html&quot;)</code></pre><p>Make sure that it has this content:</p><pre><code class="language-html hljs">&lt;!-- app/resources/books/views/new.jl.html --&gt;
&lt;h2&gt;Add a new book recommended by Bill Gates&lt;/h2&gt;
&lt;p&gt;
  For inspiration you can visit &lt;a href=&quot;https://www.gatesnotes.com/Books&quot; target=&quot;_blank&quot;&gt;Bill Gates&#39; website&lt;/a&gt;
&lt;/p&gt;
&lt;form action=&quot;$(Genie.Router.linkto(:create_book))&quot; method=&quot;POST&quot;&gt;
  &lt;input type=&quot;text&quot; name=&quot;book_title&quot; placeholder=&quot;Book title&quot; /&gt;&lt;br /&gt;
  &lt;input type=&quot;text&quot; name=&quot;book_author&quot; placeholder=&quot;Book author&quot; /&gt;&lt;br /&gt;
  &lt;input type=&quot;submit&quot; value=&quot;Add book&quot; /&gt;
&lt;/form&gt;</code></pre><p>Notice that the form&#39;s action calls the <code>linkto</code> method, passing in the name of the route to generate the URL, resulting in the following HTML: <code>&lt;form method=&quot;POST&quot; action=&quot;/bgbooks/create&quot;&gt;</code>.</p><p>We should also update the <code>BooksController.create</code> method to do something useful with the form data. Let&#39;s make it create a new book, persist it to the database and redirect to the list of books. Here is the code:</p><pre><code class="language-julia hljs"># BooksController.jl
using Genie.Router, Genie.Renderer

function create()
  Book(title = params(:book_title), author = params(:book_author)) |&gt; save &amp;&amp; redirect(:get_bgbooks)
end</code></pre><p>A few things are worth pointing out in this snippet:</p><ul><li>again, we&#39;re accessing the <code>params</code> collection to extract the request data, in this case passing in the names of our</li></ul><p>form&#39;s inputs as parameters.</p><p>We need to bring <code>Genie.Router</code> into scope in order to access <code>params</code>;</p><ul><li>we&#39;re using the <code>redirect</code> method to perform a HTTP redirect. As the argument we&#39;re passing in the name of the route,</li></ul><p>just like we did with the form&#39;s action. However, we didn&#39;t set any route to use this name. It turns out that Genie gives default names to all the routes.</p><p>We can use these – but a word of notice: <strong>these names are generated using the properties of the route, so if the route changes it&#39;s possible that the name will change too</strong>. So either make sure your route stays unchanged – or explicitly name your routes. The autogenerated name, <code>get_bgbooks</code> corresponds to the method (<code>GET</code>) and the route (<code>bgbooks</code>).</p><p>In order to get info about the defined routes you can use the <code>Router.named_routes</code> function:</p><pre><code class="language-julia hljs">julia&gt; Router.named_routes()
OrderedCollections.OrderedDict{Symbol, Genie.Router.Route} with 6 entries:
  :get_bgbooks        =&gt; [GET] /bgbooks =&gt; billgatesbooks | :get_bgbooks
  :get_bgbooks_new    =&gt; [GET] /bgbooks/new =&gt; new | :get_bgbooks_new
  :get                =&gt; [GET] / =&gt; () | :get
  :get_api_v1_bgbooks =&gt; [GET] /api/v1/bgbooks | :get_api_v1_bgbooks
  :create_book        =&gt; [POST] /bgbooks/create | :create_book</code></pre><p>Let&#39;s try it out. Input something and submit the form. If everything goes well a new book will be persisted to the database – and it will be added at the bottom of the list of books.</p><hr/><h2 id="Uploading-files"><a class="docs-heading-anchor" href="#Uploading-files">Uploading files</a><a id="Uploading-files-1"></a><a class="docs-heading-anchor-permalink" href="#Uploading-files" title="Permalink"></a></h2><p>Our app looks great – but the list of books would be so much better if we&#39;d display the covers as well. Let&#39;s do it!</p><h3 id="Modify-the-database"><a class="docs-heading-anchor" href="#Modify-the-database">Modify the database</a><a id="Modify-the-database-1"></a><a class="docs-heading-anchor-permalink" href="#Modify-the-database" title="Permalink"></a></h3><p>The first thing we need to do is to modify our table to add a new column, for storing a reference to the name of the cover image. Per best practices, we&#39;ll use database migrations to modify the structure of our table:</p><pre><code class="language-julia hljs">julia&gt; SearchLight.Generator.newmigration(&quot;add cover column&quot;)
[debug] New table migration created at db/migrations/2019030813344258_add_cover_column.jl</code></pre><p>Now we need to edit the migration file - please make it look like this:</p><pre><code class="language-julia hljs"># db/migrations/*_add_cover_column.jl
module AddCoverColumn

import SearchLight.Migrations: add_column, add_index

# SQLite does not support column removal so the `remove_column` method is not implemented in the SearchLightSQLite adapter
# If using SQLite leave the next line commented -- otherwise uncomment it
# import SearchLight.Migrations: remove_column

function up()
  add_column(:books, :cover, :string)
end

function down()
  # if using the SQLite backend, leave the next line commented -- otherwise uncomment it
  # remove_column(:books, :cover)
end

end</code></pre><p>Looking good - lets ask SearchLight to run it:</p><pre><code class="language-julia hljs">julia&gt; SearchLight.Migration.lastup()
[debug] Executed migration AddCoverColumn up</code></pre><p>If you want to double check, ask SearchLight for the migrations status:</p><pre><code class="language-julia hljs">julia&gt; SearchLight.Migration.status()

|   |                  Module name &amp; status  |
|   |                             File name  |
|---|----------------------------------------|
|   |                   CreateTableBooks: UP |
| 1 | 2018100120160530_create_table_books.jl |
|   |                     AddCoverColumn: UP |
| 2 |   2019030813344258_add_cover_column.jl |</code></pre><p>Perfect! Now we need to add the new column as a field to the <code>Books.Book</code> model:</p><pre><code class="language-julia hljs">module Books

using SearchLight, SearchLight.Validation, BooksValidator

export Book

Base.@kwdef mutable struct Book &lt;: AbstractModel
  id::DbId = DbId()
  title::String = &quot;&quot;
  author::String = &quot;&quot;
  cover::String = &quot;&quot;
end

end</code></pre><p>As a quick test we can extend our JSON view and see that all goes well - make it look like this:</p><pre><code class="language-julia hljs"># app/resources/books/views/billgatesbooks.json.jl
&quot;Bill&#39;s Gates list of recommended books&quot; =&gt; [Dict(&quot;author&quot; =&gt; b.author,
                                                  &quot;title&quot; =&gt; b.title,
                                                  &quot;cover&quot; =&gt; b.cover) for b in books]</code></pre><p>If we navigate <a href="http://localhost:8000/api/v1/bgbooks">http://localhost:8000/api/v1/bgbooks</a> you should see the newly added &quot;cover&quot; property (empty, but present).</p><h5 id="Heads-up!"><a class="docs-heading-anchor" href="#Heads-up!">Heads up!</a><a id="Heads-up!-1"></a><a class="docs-heading-anchor-permalink" href="#Heads-up!" title="Permalink"></a></h5><p>Sometimes Julia/Genie/Revise fails to update <code>structs</code> on changes. If you get an error saying that <code>Book</code> does not have a <code>cover</code> field or that it can not be changed, you&#39;ll need to restart the Genie app.</p><h3 id="File-uploading"><a class="docs-heading-anchor" href="#File-uploading">File uploading</a><a id="File-uploading-1"></a><a class="docs-heading-anchor-permalink" href="#File-uploading" title="Permalink"></a></h3><p>Next step, extending our form to upload images (book covers). Please edit the <code>new.jl.html</code> view file as follows:</p><pre><code class="language-html hljs">&lt;h3&gt;Add a new book recommended by Bill Gates&lt;/h3&gt;
&lt;p&gt;
  For inspiration you can visit &lt;a href=&quot;https://www.gatesnotes.com/Books&quot; target=&quot;_blank&quot;&gt;Bill Gates&#39; website&lt;/a&gt;
&lt;/p&gt;
&lt;form action=&quot;$(Genie.Router.linkto(:create_book))&quot; method=&quot;POST&quot; enctype=&quot;multipart/form-data&quot;&gt;
  &lt;input type=&quot;text&quot; name=&quot;book_title&quot; placeholder=&quot;Book title&quot; /&gt;&lt;br /&gt;
  &lt;input type=&quot;text&quot; name=&quot;book_author&quot; placeholder=&quot;Book author&quot; /&gt;&lt;br /&gt;
  &lt;input type=&quot;file&quot; name=&quot;book_cover&quot; /&gt;&lt;br /&gt;
  &lt;input type=&quot;submit&quot; value=&quot;Add book&quot; /&gt;
&lt;/form&gt;</code></pre><p>The new bits are:</p><ul><li>we added a new attribute to our <code>&lt;form&gt;</code> tag: <code>enctype=&quot;multipart/form-data&quot;</code>. This is required in order to support files payloads.</li><li>there&#39;s a new input of type file: <code>&lt;input type=&quot;file&quot; name=&quot;book_cover&quot; /&gt;</code></li></ul><p>You can see the updated form by visiting <a href="http://localhost:8000/bgbooks/new">http://localhost:8000/bgbooks/new</a></p><p>Now, time to add a new book, with the cover! How about &quot;Identity&quot; by Francis Fukuyama? Sounds good. You can use whatever image you want for the cover, or maybe borrow the one from Bill Gates, I hope he won&#39;t mind <a href="https://www.gatesnotes.com/-/media/Images/GoodReadsBookCovers/Identity.png">https://www.gatesnotes.com/-/media/Images/GoodReadsBookCovers/Identity.png</a>. Just download the file to your computer so you can upload it through our form.</p><p>Almost there - now to add the logic for handling the uploaded file server side. Please update the <code>BooksController.create</code> method to look like this:</p><pre><code class="language-julia hljs"># BooksController
function create()
  cover_path = if haskey(filespayload(), &quot;book_cover&quot;)
      path = joinpath(&quot;img&quot;, &quot;covers&quot;, filespayload(&quot;book_cover&quot;).name)
      write(joinpath(&quot;public&quot;, path), IOBuffer(filespayload(&quot;book_cover&quot;).data))

      path
    else
      &quot;&quot;
  end

  Book( title = params(:book_title),
        author = params(:book_author),
        cover = cover_path) |&gt; save &amp;&amp; redirect(:get_bgbooks)
end</code></pre><p>Also, very important, you need to make sure that <code>BooksController</code> is <code>using Genie.Requests</code>.</p><p>Regarding the code, there&#39;s nothing very fancy about it. First we check if the files payload contains an entry for our <code>book_cover</code> input. If yes, we compute the path where we want to store the file, write the file, and store the path in the database.</p><p><strong>Please make sure that you create the folder <code>covers/</code> within <code>public/img/</code></strong>.</p><p>Great, now let&#39;s display the images. Let&#39;s start with the HTML view - please edit <code>app/resources/books/views/billgatesbooks.jl.html</code> and make sure it has the following content:</p><pre><code class="language-html hljs">&lt;!-- app/resources/books/views/billgatesbooks.jl.html --&gt;
&lt;h1&gt;Bill&#39;s Gates top $( length(books) ) recommended books&lt;/h1&gt;
&lt;ul&gt;
&lt;%
for_each(books) do book
%&gt;
  &lt;li&gt;&lt;img src=&#39;$( isempty(book.cover) ? &quot;img/docs.png&quot; : book.cover )&#39; width=&quot;100px&quot; /&gt; $(book.title) by $(book.author)&lt;/li&gt;
&lt;%
end
%&gt;
&lt;/ul&gt;</code></pre><p>Here we check if the <code>cover</code> property is not empty, and display the actual cover. Otherwise we show a placeholder image. You can check the result at <a href="http://localhost:8000/bgbooks">http://localhost:8000/bgbooks</a></p><p>As for the JSON view, it already does what we want - you can check that the <code>cover</code> property is now outputted, as stored in the database: <a href="http://localhost:8000/api/v1/bgbooks">http://localhost:8000/api/v1/bgbooks</a></p><p>Success, we&#39;re done here!</p><h4 id="Heads-up!-2"><a class="docs-heading-anchor" href="#Heads-up!-2">Heads up!</a><a class="docs-heading-anchor-permalink" href="#Heads-up!-2" title="Permalink"></a></h4><p>In production you will have to make the upload code more robust - the big problem here is that we store the cover file as it comes from the user which can lead to name clashes and files being overwritten - not to mention security vulnerabilities. A more robust way would be to compute a hash based on author and title and rename the cover to that.</p><h3 id="One-more-thing"><a class="docs-heading-anchor" href="#One-more-thing">One more thing</a><a id="One-more-thing-1"></a><a class="docs-heading-anchor-permalink" href="#One-more-thing" title="Permalink"></a></h3><p>So far so good, but what if we want to update the books we have already uploaded? It would be nice to add those missing covers. We need to add a bit of functionality to include editing features.</p><p>First things first - let&#39;s add the routes. Please add these two new route definitions to the <code>routes.jl</code> file:</p><pre><code class="language-julia hljs">route(&quot;/bgbooks/:id::Int/edit&quot;, BooksController.edit)
route(&quot;/bgbooks/:id::Int/update&quot;, BooksController.update, method = POST, named = :update_book)</code></pre><p>We defined two new routes. The first will display the book object in the form, for editing. While the second will take care of actually updating the database, server side. For both routes we need to pass the id of the book that we want to edit - and we want to constrain it to an <code>Int</code>. We express this as the <code>/:id::Int/</code> part of the route.</p><p>We also want to:</p><ul><li>reuse the form which we have defined in <code>app/resources/books/views/new.jl.html</code></li><li>make the form aware of whether it&#39;s used to create a new book, or for editing an existing one respond accordingly by setting the correct <code>action</code></li><li>pre-fill the inputs with the book&#39;s info when editing a book.</li></ul><p>OK, that&#39;s quite a list and this is where things become interesting. This is an important design pattern for CRUD web apps. In order to simplify the rendering of the form, we will always pass a book object into it. When editing a book it will be the book corresponding to the <code>id</code> passed into the <code>route</code>. And when creating a new book, it will be just an empty book object we&#39;ll create and then dispose of.</p><h4 id="Using-view-partials"><a class="docs-heading-anchor" href="#Using-view-partials">Using view partials</a><a id="Using-view-partials-1"></a><a class="docs-heading-anchor-permalink" href="#Using-view-partials" title="Permalink"></a></h4><p>First, let&#39;s set up the views. In <code>app/resources/books/views/</code> please create a new file called <code>form.jl.html</code>. Then, from <code>app/resources/books/views/new.jl.html</code> cut the <code>&lt;form&gt;</code> code. That is, everything between the opening and closing <code>&lt;form&gt;...&lt;/form&gt;</code> tags. Paste it into the newly created <code>form.jl.html</code> file. Now, back to <code>new.jl.html</code>, instead of the previous <code>&lt;form&gt;...&lt;/form&gt;</code> code add:</p><pre><code class="language-julia hljs">&lt;% partial(&quot;app/resources/books/views/form.jl.html&quot;, context = @__MODULE__) %&gt;</code></pre><p>This line, as the <code>partial</code> function suggests, includes a view partial, which is a part of a view file, effectively including a view within another view. Notice that we&#39;re explicitly passing the <code>context</code> so Genie can set the correct variable scope when including the partial.</p><p>You can reload the <code>new</code> page to make sure that everything still works: <a href="http://localhost:8000/bgbooks/new">http://localhost:8000/bgbooks/new</a></p><p>Now, let&#39;s add an Edit option to our list of books. Please go back to our list view file, <code>billgatesbooks.jl.html</code>. Here, for each iteration, within the <code>for_each</code> block we&#39;ll want to dynamically link to the edit page for the corresponding book.</p><h5 id="for_each-with-view-partials"><a class="docs-heading-anchor" href="#for_each-with-view-partials"><code>for_each</code> with view partials</a><a id="for_each-with-view-partials-1"></a><a class="docs-heading-anchor-permalink" href="#for_each-with-view-partials" title="Permalink"></a></h5><p>However, this <code>for_each</code> which renders a Julia string is very ugly - and we now know how to refactor it, by using a view partial. Let&#39;s do it. First, replace the body of the <code>for_each</code> block:</p><pre><code class="language-html hljs">&lt;!-- app/resources/books/views/billgatesbooks.jl.html --&gt;
&quot;&quot;&quot;&lt;li&gt;&lt;img src=&#39;$( isempty(book.cover) ? &quot;img/docs.png&quot; : book.cover )&#39; width=&quot;100px&quot; /&gt; $(book.title) by $(book.author)&quot;&quot;&quot;</code></pre><p>with:</p><pre><code class="language-julia hljs">partial(&quot;app/resources/books/views/book.jl.html&quot;, book = book, context = @__MODULE__)</code></pre><p>Notice that we are using the <code>partial</code> function and we pass the book object into our view, under the name <code>book</code> (will be accessible in <code>book</code> inside the view partial). Again, we&#39;re passing the scope&#39;s <code>context</code> (our controller object).</p><p>Next, create the <code>book.jl.html</code> in <code>app/resources/books/views/</code>, for example with</p><pre><code class="language-julia hljs">julia&gt; touch(&quot;app/resources/books/views/book.jl.html&quot;)</code></pre><p>Add this content to it: TO BE CONTINUED</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="Working_With_Genie_Apps.html">« Working with Genie Apps</a><a class="docs-footer-nextpage" href="Interactive_environment.html">Using Genie in an interactive environment »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Friday 12 September 2025 14:34">Friday 12 September 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
