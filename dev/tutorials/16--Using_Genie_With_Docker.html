<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Using Genie with Docker · Genie - The Highly Productive Julia Web Framework</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../index.html">Genie - The Highly Productive Julia Web Framework</a></span></div><form class="docs-search" action="../search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../index.html">Home</a></li><li><span class="tocitem">Guides</span><ul><li><a class="tocitem" href="../guides/Migrating_from_v4_to_v5.html">Migrating Genie v4 apps to Genie v5</a></li><li><a class="tocitem" href="../guides/Working_With_Genie_Apps.html">Working with Genie Apps</a></li><li><a class="tocitem" href="../guides/Working_With_Genie_Apps_Intermediary_Topics.html">Working With Genie Apps: Intermediate Topics [WIP]</a></li><li><a class="tocitem" href="../guides/Interactive_environment.html">Using Genie in an interactive environment</a></li><li><a class="tocitem" href="../guides/Simple_API_backend.html">Developing an API backend</a></li><li><a class="tocitem" href="../guides/Genie_Plugins.html">Using Genie Plugins</a></li><li><a class="tocitem" href="../guides/Deploying_Genie_Apps_On_AWS.html">Deploying Genie Apps On AWS</a></li><li><a class="tocitem" href="../guides/Controlling_Load_Order_Of_Genie_Apps.html">Controlling Load Order of Genie Apps</a></li></ul></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="1--Overview.html">Welcome to Genie</a></li><li><a class="tocitem" href="2--Installing_Genie.html">Installing Genie</a></li><li><a class="tocitem" href="3--Getting_Started.html">Getting started</a></li><li><a class="tocitem" href="4--Developing_Web_Services.html">Creating a web service</a></li><li><a class="tocitem" href="4-1--Developing_MVC_Web_Apps.html">Developing MVC web applications</a></li><li><a class="tocitem" href="5--Handling_Query_Params.html">Handling URI/query params</a></li><li><a class="tocitem" href="6--Working_with_POST_Payloads.html">Working with forms and POST payloads</a></li><li><a class="tocitem" href="7--Using_JSON_Payloads.html">Using JSON payloads</a></li><li><a class="tocitem" href="8--Handling_File_Uploads.html">Uploading files</a></li><li><a class="tocitem" href="9--Publishing_Your_Julia_Code_Online_With_Genie_Apps.html">Adding your libraries into Genie</a></li><li><a class="tocitem" href="10--Loading_Genie_Apps.html">Loading and starting Genie apps</a></li><li><a class="tocitem" href="11--Managing_External_Packages.html">Managing Genie app&#39;s dependencies</a></li><li><a class="tocitem" href="12--Advanced_Routing_Techniques.html">Advanced routing</a></li><li><a class="tocitem" href="13--Initializers.html">Auto-loading configuration code with initializers</a></li><li><a class="tocitem" href="14--The_Secrets_File.html">The secrets file</a></li><li><a class="tocitem" href="15--The_Lib_Folder.html">Auto-loading user libraries</a></li><li class="is-active"><a class="tocitem" href="16--Using_Genie_With_Docker.html">Using Genie with Docker</a><ul class="internal"><li><a class="tocitem" href="#Setting-up-GenieDeployDocker"><span>Setting up <code>GenieDeployDocker</code></span></a></li><li><a class="tocitem" href="#Generating-the-Genie-optimised-Dockerfile"><span>Generating the Genie-optimised <code>Dockerfile</code></span></a></li><li><a class="tocitem" href="#Building-the-Docker-container"><span>Building the Docker container</span></a></li><li><a class="tocitem" href="#Running-the-Genie-app-within-the-Docker-container"><span>Running the Genie app within the Docker container</span></a></li><li><a class="tocitem" href="#Examples"><span>Examples</span></a></li><li><a class="tocitem" href="#Inspecting-the-containers"><span>Inspecting the containers</span></a></li><li><a class="tocitem" href="#Stopping-running-containers"><span>Stopping running containers</span></a></li><li><a class="tocitem" href="#Using-Docker-during-development"><span>Using Docker during development</span></a></li><li><a class="tocitem" href="#Creating-an-optimized-Genie-sysimage-with-PackageCompiler.jl"><span>Creating an optimized Genie sysimage with <code>PackageCompiler.jl</code></span></a></li></ul></li><li><a class="tocitem" href="17--Working_with_Web_Sockets.html">Working with WebSockets</a></li><li><a class="tocitem" href="90--Deploying_With_Heroku_Buildpacks.html">Deploying to Heroku with Buildpacks</a></li><li><a class="tocitem" href="92--Deploying_Genie_Server_Apps_with_Nginx.html">Deploying to server with Nginx</a></li></ul></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="../API/assets.html">Assets</a></li><li><a class="tocitem" href="../API/commands.html">Commands</a></li><li><a class="tocitem" href="../API/configuration.html">Configuration</a></li><li><a class="tocitem" href="../API/cookies.html">Cookies</a></li><li><a class="tocitem" href="../API/encryption.html">Encryption</a></li><li><a class="tocitem" href="../API/exceptions.html">Exceptions</a></li><li><a class="tocitem" href="../API/filetemplates.html">FileTemplates</a></li><li><a class="tocitem" href="../API/generator.html">Generator</a></li><li><a class="tocitem" href="../API/genie.html">Genie</a></li><li><a class="tocitem" href="../API/headers.html">Headers</a></li><li><a class="tocitem" href="../API/httputils.html">HttpUtils</a></li><li><a class="tocitem" href="../API/input.html">Input</a></li><li><a class="tocitem" href="../API/loader.html">Loader</a></li><li><a class="tocitem" href="../API/logger.html">Logger</a></li><li><a class="tocitem" href="../API/renderer.html">Renderer</a></li><li><a class="tocitem" href="../API/renderer-html.html">HTML Renderer</a></li><li><a class="tocitem" href="../API/renderer-js.html">JS Renderer</a></li><li><a class="tocitem" href="../API/renderer-json.html">JSON Renderer</a></li><li><a class="tocitem" href="../API/requests.html">Requests</a></li><li><a class="tocitem" href="../API/responses.html">Responses</a></li><li><a class="tocitem" href="../API/router.html">Router</a></li><li><a class="tocitem" href="../API/secrets.html">Secrets</a></li><li><a class="tocitem" href="../API/server.html">Server</a></li><li><a class="tocitem" href="../API/toolbox.html">Toolbox</a></li><li><a class="tocitem" href="../API/util.html">Util</a></li><li><a class="tocitem" href="../API/watch.html">Watch</a></li><li><a class="tocitem" href="../API/webchannels.html">WebChannels</a></li><li><a class="tocitem" href="../API/webthreads.html">WebThreads</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href="16--Using_Genie_With_Docker.html">Using Genie with Docker</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="16--Using_Genie_With_Docker.html">Using Genie with Docker</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/GenieFramework/Genie.jl/blob/master/docs/src/tutorials/16--Using_Genie_With_Docker.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Using-Genie-with-Docker"><a class="docs-heading-anchor" href="#Using-Genie-with-Docker">Using Genie with Docker</a><a id="Using-Genie-with-Docker-1"></a><a class="docs-heading-anchor-permalink" href="#Using-Genie-with-Docker" title="Permalink"></a></h1><p>Genie comes with extended support for containerizing apps using Docker. The functionality is provided by the official <code>GenieDeployDocker</code> plugin.</p><h2 id="Setting-up-GenieDeployDocker"><a class="docs-heading-anchor" href="#Setting-up-GenieDeployDocker">Setting up <code>GenieDeployDocker</code></a><a id="Setting-up-GenieDeployDocker-1"></a><a class="docs-heading-anchor-permalink" href="#Setting-up-GenieDeployDocker" title="Permalink"></a></h2><p>In order to use the Docker integration features, first we need to add the <code>GenieDeployDocker</code> plugin for <code>Genie</code>.</p><pre><code class="language-julia hljs">pkg&gt; add GenieDeployDocker</code></pre><h2 id="Generating-the-Genie-optimised-Dockerfile"><a class="docs-heading-anchor" href="#Generating-the-Genie-optimised-Dockerfile">Generating the Genie-optimised <code>Dockerfile</code></a><a id="Generating-the-Genie-optimised-Dockerfile-1"></a><a class="docs-heading-anchor-permalink" href="#Generating-the-Genie-optimised-Dockerfile" title="Permalink"></a></h2><p>You can bootstrap the Docker setup by invoking the <code>GenieDeployDocker.dockerfile()</code> function. This will generate a custom <code>Dockerfile</code> optimized for Genie web apps containerization. The file will be generated in the current work dir (or where instructed by the optional argument <code>path</code> – see the help for the <code>dockerfile()</code> function).</p><p>Once generated, you can edit it and customize it as needed - Genie will not overwrite the file, thus preserving any changes (unless you call the <code>dockerfile</code> function again, passing the <code>force=true</code> argument).</p><p>The behavior of <code>dockerfile()</code> can be controlled by passing any of the multiple optional arguments supported.</p><h2 id="Building-the-Docker-container"><a class="docs-heading-anchor" href="#Building-the-Docker-container">Building the Docker container</a><a id="Building-the-Docker-container-1"></a><a class="docs-heading-anchor-permalink" href="#Building-the-Docker-container" title="Permalink"></a></h2><p>Once we have our <code>Dockerfile</code> ready, we can invoke <code>GenieDeployDocker.build()</code> to set up the Docker container. You can pass any of the supported optional arguments to configure settings such as the container&#39;s name (by default <code>&quot;genie&quot;</code>), the path (defaults to current work dir), and others (see the output of <code>help?&gt; GenieDeployDocker.dockerfile</code> for all the available options).</p><h2 id="Running-the-Genie-app-within-the-Docker-container"><a class="docs-heading-anchor" href="#Running-the-Genie-app-within-the-Docker-container">Running the Genie app within the Docker container</a><a id="Running-the-Genie-app-within-the-Docker-container-1"></a><a class="docs-heading-anchor-permalink" href="#Running-the-Genie-app-within-the-Docker-container" title="Permalink"></a></h2><p>When the image is ready, we can run it with <code>GenieDeployDocker.run()</code>. We can configure any of the optional arguments in order to control how the app is run. Check the inline help for the function for more details.</p><h2 id="Examples"><a class="docs-heading-anchor" href="#Examples">Examples</a><a id="Examples-1"></a><a class="docs-heading-anchor-permalink" href="#Examples" title="Permalink"></a></h2><p>First let&#39;s create a Genie app:</p><pre><code class="language-julia hljs">julia&gt; using Genie

julia&gt; Genie.Generator.newapp(&quot;DockerTest&quot;)
[ Info: Done! New app created at /your/app/path/DockerTest
# output truncated</code></pre><p>When it&#39;s ready, let&#39;s add the <code>Dockerfile</code>:</p><pre><code class="language-julia hljs">julia&gt; using GenieDeployDocker

julia&gt; GenieDeployDocker.dockerfile()
Docker file successfully written at /your/app/path/DockerTest/Dockerfile</code></pre><p>Now, to build our container:</p><pre><code class="language-julia hljs">julia&gt; GenieDeployDocker.build()
# output truncated
Successfully tagged genie:latest
Docker container successfully built</code></pre><p>And finally, we can now run our app within the Docker container:</p><pre><code class="language-julia hljs">julia&gt; GenieDeployDocker.run()
Starting docker container with `docker run -it --rm -p 80:8000 --name genieapp genie bin/server`
# output truncated</code></pre><p>We should then see the familiar Genie loading screen, indicating the app&#39;s loading progress and notifying us once the app is running.</p><p>Our application starts inside the Docker container, binding port 8000 within the container (where the Genie app is running) to the port 80 of the host. So we are now able to access our app at <code>http://localhost</code>. If you navigate to <code>http://localhost</code> w ith your favorite browser you&#39;ll see Genie&#39;s welcome page. Notice that we don&#39;t access on port 8000 - this page is served from the Docker container on the default port 80.</p><h2 id="Inspecting-the-containers"><a class="docs-heading-anchor" href="#Inspecting-the-containers">Inspecting the containers</a><a id="Inspecting-the-containers-1"></a><a class="docs-heading-anchor-permalink" href="#Inspecting-the-containers" title="Permalink"></a></h2><p>We can get a list of available container by using <code>GenieDeployDocker.list()</code>. This will show only the currently running containers by default, but we can pass the <code>all=true</code> argument to also include containers that are offline.</p><pre><code class="language-julia hljs">julia&gt; GenieDeployDocker.list()
CONTAINER ID   IMAGE     COMMAND        CREATED         STATUS         PORTS                          NAMES
c87bfd8322cc   genie     &quot;bin/server&quot;   6 minutes ago   Up 6 minutes   80/tcp, 0.0.0.0:80-&gt;8000/tcp   genieapp
Process(`docker ps`, ProcessExited(0))</code></pre><h2 id="Stopping-running-containers"><a class="docs-heading-anchor" href="#Stopping-running-containers">Stopping running containers</a><a id="Stopping-running-containers-1"></a><a class="docs-heading-anchor-permalink" href="#Stopping-running-containers" title="Permalink"></a></h2><p>The running containers can be stopped by using the <code>GenieDeployDocker.stop()</code> function, passing the name of the container.</p><pre><code class="language-julia hljs">julia&gt; GenieDeployDocker.stop(&quot;genieapp&quot;)</code></pre><h2 id="Using-Docker-during-development"><a class="docs-heading-anchor" href="#Using-Docker-during-development">Using Docker during development</a><a id="Using-Docker-during-development-1"></a><a class="docs-heading-anchor-permalink" href="#Using-Docker-during-development" title="Permalink"></a></h2><p>If we want to use Docker to serve the app during development, we need to <em>mount</em> our app from host (your computer) into the container – so that we can keep editing our files locally, but see the changes reflected in the Docker container. In order to do this we need to pass the <code>mountapp = true</code> argument to <code>GenieDeployDocker.run()</code>, like this:</p><pre><code class="language-julia hljs">julia&gt; GenieDeployDocker.run(mountapp = true)
Starting docker container with `docker run -it --rm -p 80:8000 --name genieapp -v /Users/adrian/DockerTest:/home/genie/app genie bin/server`</code></pre><p>When the app finishes starting, we can edit the files on the host using our favorite IDE, and see the changes reflected in the Docker container.</p><h2 id="Creating-an-optimized-Genie-sysimage-with-PackageCompiler.jl"><a class="docs-heading-anchor" href="#Creating-an-optimized-Genie-sysimage-with-PackageCompiler.jl">Creating an optimized Genie sysimage with <code>PackageCompiler.jl</code></a><a id="Creating-an-optimized-Genie-sysimage-with-PackageCompiler.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Creating-an-optimized-Genie-sysimage-with-PackageCompiler.jl" title="Permalink"></a></h2><p>If we are using Docker containers to deploy Genie apps in production, you can greatly improve the performance of the app by preparing a precompiled sysimage for Julia. We can include this workflow as part of the Docker <code>build</code> step as follows.</p><h3 id="Edit-the-Dockerfile"><a class="docs-heading-anchor" href="#Edit-the-Dockerfile">Edit the <code>Dockerfile</code></a><a id="Edit-the-Dockerfile-1"></a><a class="docs-heading-anchor-permalink" href="#Edit-the-Dockerfile" title="Permalink"></a></h3><p>We&#39;ll start by making a few changes to our <code>Dockerfile</code>, as follows:</p><p>1/ Under the line <code>WORKDIR /home/genie/app</code> add</p><pre><code class="language-dockerfile hljs"># C compiler for PackageCompiler
RUN apt-get update &amp;&amp; apt-get install -y g++</code></pre><p>2/ Under the line starting with <code>RUN julia -e</code> add</p><pre><code class="language-dockerfile hljs"># Compile app
RUN julia --project compiled/make.jl</code></pre><p>You may also want to replace the line saying</p><pre><code class="language-dockerfile hljs">ENV GENIE_ENV &quot;dev&quot;</code></pre><p>with</p><pre><code class="language-dockerfile hljs">ENV GENIE_ENV &quot;prod&quot;</code></pre><p>to configure the application to run in production (first test locally to make sure that everything is properly configured to run the app in production environment).</p><h3 id="Add-PackageCompiler.jl"><a class="docs-heading-anchor" href="#Add-PackageCompiler.jl">Add <code>PackageCompiler.jl</code></a><a id="Add-PackageCompiler.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Add-PackageCompiler.jl" title="Permalink"></a></h3><p>We also need to add <code>PackageCompiler</code> as a dependency of our app:</p><pre><code class="language-julia hljs">pkg&gt; add PackageCompiler</code></pre><h3 id="Add-the-needed-files"><a class="docs-heading-anchor" href="#Add-the-needed-files">Add the needed files</a><a id="Add-the-needed-files-1"></a><a class="docs-heading-anchor-permalink" href="#Add-the-needed-files" title="Permalink"></a></h3><p>Create a new folder to host our files:</p><pre><code class="language-julia hljs">julia&gt; mkdir(&quot;compiled&quot;)</code></pre><p>Now create the following files:</p><pre><code class="language-julia hljs">julia&gt; touch(&quot;compiled/make.jl&quot;)
julia&gt; touch(&quot;compiled/packages.jl&quot;)</code></pre><h3 id="Edit-the-files"><a class="docs-heading-anchor" href="#Edit-the-files">Edit the files</a><a id="Edit-the-files-1"></a><a class="docs-heading-anchor-permalink" href="#Edit-the-files" title="Permalink"></a></h3><p>Now to put the content into each of the files.</p><h4 id="Preparing-the-packages.jl-file"><a class="docs-heading-anchor" href="#Preparing-the-packages.jl-file">Preparing the <code>packages.jl</code> file</a><a id="Preparing-the-packages.jl-file-1"></a><a class="docs-heading-anchor-permalink" href="#Preparing-the-packages.jl-file" title="Permalink"></a></h4><p>Here we simply put an array of package that our app uses and that we want to precompile, ex:</p><pre><code class="language-julia hljs"># packages.jl
const PACKAGES = [
  &quot;Dates&quot;,
  &quot;Genie&quot;,
  &quot;Inflector&quot;,
  &quot;Logging&quot;
]</code></pre><h4 id="Preparing-the-make.jl-file"><a class="docs-heading-anchor" href="#Preparing-the-make.jl-file">Preparing the <code>make.jl</code> file</a><a id="Preparing-the-make.jl-file-1"></a><a class="docs-heading-anchor-permalink" href="#Preparing-the-make.jl-file" title="Permalink"></a></h4><p>Now edit the <code>make.jl</code> file as follows:</p><pre><code class="language-julia hljs"># make.jl
using PackageCompiler

include(&quot;packages.jl&quot;)

PackageCompiler.create_sysimage(
  PACKAGES,
  sysimage_path = &quot;compiled/sysimg.so&quot;,
  cpu_target = PackageCompiler.default_app_cpu_target()
)</code></pre><h4 id="Using-the-precompiled-image"><a class="docs-heading-anchor" href="#Using-the-precompiled-image">Using the precompiled image</a><a id="Using-the-precompiled-image-1"></a><a class="docs-heading-anchor-permalink" href="#Using-the-precompiled-image" title="Permalink"></a></h4><p>The result of these changes is that <code>PackageCompiler</code> will create a new Julia sysimage that will be stored inside the <code>compiled/sysimg.so</code> file. The last step is to instruct our <code>bin/server</code> script to use the image.</p><p>Edit the <code>bin/server</code> file and make it look like this:</p><pre><code class="language-bash hljs">julia --color=yes --depwarn=no --project=@. --sysimage=compiled/sysimg.so -q -i -- $(dirname $0)/../bootstrap.jl -s=true &quot;$@&quot;</code></pre><p>With this change we&#39;re passing the additional <code>--sysimage</code> flag, indicating our new Julia sys image.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="15--The_Lib_Folder.html">« Auto-loading user libraries</a><a class="docs-footer-nextpage" href="17--Working_with_Web_Sockets.html">Working with WebSockets »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Monday 26 February 2024 18:23">Monday 26 February 2024</span>. Using Julia version 1.10.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
