<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Deploying to server with Nginx · Genie - The Highly Productive Julia Web Framework</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><script src="../../copy.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../index.html">Genie - The Highly Productive Julia Web Framework</a></span></div><form class="docs-search" action="../search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../index.html">Home</a></li><li><span class="tocitem">Guides</span><ul><li><a class="tocitem" href="../guides/Working_With_Genie_Apps.html">Working with Genie Apps</a></li><li><a class="tocitem" href="../guides/Interactive_environment.html">Using Genie in an interactive environment</a></li><li><a class="tocitem" href="../guides/Simple_API_backend.html">Developing an API backend</a></li><li><a class="tocitem" href="../guides/Genie_Plugins.html">Using Genie Plugins</a></li><li><a class="tocitem" href="../guides/Working_With_Genie_Apps_Intermediary_Topics.html">Working With Genie Apps: Intermediate Topics [WIP]</a></li></ul></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="1--Overview.html">Welcome to Genie</a></li><li><a class="tocitem" href="2--Installing_Genie.html">Installing Genie</a></li><li><a class="tocitem" href="3--Getting_Started.html">Getting started</a></li><li><a class="tocitem" href="4--Developing_Web_Services.html">Creating a web service</a></li><li><a class="tocitem" href="4-1--Developing_MVC_Web_Apps.html">Developing MVC web applications</a></li><li><a class="tocitem" href="5--Handling_Query_Params.html">Handling URI/query params</a></li><li><a class="tocitem" href="6--Working_with_POST_Payloads.html">Working with forms and POST payloads</a></li><li><a class="tocitem" href="7--Using_JSON_Payloads.html">Using JSON payloads</a></li><li><a class="tocitem" href="8--Handling_File_Uploads.html">Uploading files</a></li><li><a class="tocitem" href="9--Publishing_Your_Julia_Code_Online_With_Genie_Apps.html">Adding your libraries into Genie</a></li><li><a class="tocitem" href="10--Loading_Genie_Apps.html">Loading and starting Genie apps</a></li><li><a class="tocitem" href="11--Managing_External_Packages.html">Managing Genie app&#39;s dependencies</a></li><li><a class="tocitem" href="12--Advanced_Routing_Techniques.html">Advanced routing</a></li><li><a class="tocitem" href="13--Initializers.html">Auto-loading configuration code with initializers</a></li><li><a class="tocitem" href="14--The_Secrets_File.html">The secrets file</a></li><li><a class="tocitem" href="15--The_Lib_Folder.html">Auto-loading user libraries</a></li><li><a class="tocitem" href="16--Using_Genie_With_Docker.html">Using Genie with Docker</a></li><li><a class="tocitem" href="17--Working_with_Web_Sockets.html">Working with WebSockets</a></li><li><a class="tocitem" href="80--Force_Compiling_Routes.html">Force compiling route handlers</a></li><li><a class="tocitem" href="90--Deploying_With_Heroku_Buildpacks.html">Deploying to Heroku with Buildpacks</a></li><li><a class="tocitem" href="91--Deploying_Genie_Docker_Apps_on_Heroku.html">Deploying to Heroku with Docker</a></li><li class="is-active"><a class="tocitem" href="92--Deploying_Genie_Server_Apps_with_Nginx.html">Deploying to server with Nginx</a><ul class="internal"><li><a class="tocitem" href="#Prerequisites"><span>Prerequisites</span></a></li><li><a class="tocitem" href="#The-application"><span>The application</span></a></li><li><a class="tocitem" href="#Install-and-run-the-Genie-app-on-the-server"><span>Install and run the Genie app on the server</span></a></li><li><a class="tocitem" href="#Install-and-configure-nginx-server"><span>Install and configure nginx server</span></a></li><li><a class="tocitem" href="#Enable-HTTPS"><span>Enable HTTPS</span></a></li></ul></li></ul></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="../api/app.html">App</a></li><li><a class="tocitem" href="../api/appserver.html">AppServer</a></li><li><a class="tocitem" href="../api/assets.html">Assets</a></li><li><a class="tocitem" href="../api/cache.html">Cache</a></li><li><a class="tocitem" href="../api/commands.html">Commands</a></li><li><a class="tocitem" href="../api/configuration.html">Configuration</a></li><li><a class="tocitem" href="../api/cookies.html">Cookies</a></li><li><input class="collapse-toggle" id="menuitem-4-8" type="checkbox"/><label class="tocitem" for="menuitem-4-8"><span class="docs-label">Deploy</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../api/deploy-docker.html">Docker</a></li><li><a class="tocitem" href="../api/deploy-heroku.html">Heroku</a></li></ul></li><li><a class="tocitem" href="../api/encryption.html">Encryption</a></li><li><a class="tocitem" href="../api/exceptions.html">Exceptions</a></li><li><a class="tocitem" href="../api/filetemplates.html">FileTemplates</a></li><li><a class="tocitem" href="../api/flash.html">Flash</a></li><li><a class="tocitem" href="../api/generator.html">Generator</a></li><li><a class="tocitem" href="../api/genie.html">Genie</a></li><li><a class="tocitem" href="../api/headers.html">Headers</a></li><li><a class="tocitem" href="../api/httputils.html">HttpUtils</a></li><li><a class="tocitem" href="../api/input.html">Input</a></li><li><a class="tocitem" href="../api/plugins.html">Plugins</a></li><li><a class="tocitem" href="../api/renderer.html">Renderer</a></li><li><a class="tocitem" href="../api/renderer-html.html">HTML Renderer</a></li><li><a class="tocitem" href="../api/renderer-js.html">JS Renderer</a></li><li><a class="tocitem" href="../api/renderer-json.html">JSON Renderer</a></li><li><a class="tocitem" href="../api/requests.html">Requests</a></li><li><a class="tocitem" href="../api/responses.html">Responses</a></li><li><a class="tocitem" href="../api/router.html">Router</a></li><li><a class="tocitem" href="../api/sessions.html">Sessions</a></li><li><a class="tocitem" href="../api/toolbox.html">Toolbox</a></li><li><a class="tocitem" href="../api/util.html">Util</a></li><li><a class="tocitem" href="../api/webchannels.html">WebChannels</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href="92--Deploying_Genie_Server_Apps_with_Nginx.html">Deploying to server with Nginx</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="92--Deploying_Genie_Server_Apps_with_Nginx.html">Deploying to server with Nginx</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/GenieFramework/Genie.jl/blob/master/docs/src/tutorials/92--Deploying_Genie_Server_Apps_with_Nginx.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Deploying-Genie-apps-to-server-with-Nginx"><a class="docs-heading-anchor" href="#Deploying-Genie-apps-to-server-with-Nginx">Deploying Genie apps to server with Nginx</a><a id="Deploying-Genie-apps-to-server-with-Nginx-1"></a><a class="docs-heading-anchor-permalink" href="#Deploying-Genie-apps-to-server-with-Nginx" title="Permalink"></a></h1><p>This tutorial shows how to host a Julia/Genie app on with Nginx.</p><h2 id="Prerequisites"><a class="docs-heading-anchor" href="#Prerequisites">Prerequisites</a><a id="Prerequisites-1"></a><a class="docs-heading-anchor-permalink" href="#Prerequisites" title="Permalink"></a></h2><p>To expose the app over the internet, one needs access to a server. This can be a local machine or a cloud instance such as AWS EC2 or a Google Cloud Compute Engine for example).</p><p>If using a local server, a static IP is needed to ensure continuous access to the app. Internet service provider generally charge a fee for such extra service.</p><h2 id="The-application"><a class="docs-heading-anchor" href="#The-application">The application</a><a id="The-application-1"></a><a class="docs-heading-anchor-permalink" href="#The-application" title="Permalink"></a></h2><p>We assume that a Genie app has been developed and is ready for deployment and that it is hosted as a project on a git repository.</p><p>For example, the app <code>MyGenieApp</code> generated through <code>Genie.newapp(&quot;MyGenieApp&quot;)</code> being hosted at <code>github.com/user/MyGenieApp</code>.</p><p>The scripts presented in this tutorial are for Ubuntu 20.04.</p><h2 id="Install-and-run-the-Genie-app-on-the-server"><a class="docs-heading-anchor" href="#Install-and-run-the-Genie-app-on-the-server">Install and run the Genie app on the server</a><a id="Install-and-run-the-Genie-app-on-the-server-1"></a><a class="docs-heading-anchor-permalink" href="#Install-and-run-the-Genie-app-on-the-server" title="Permalink"></a></h2><p>Access the server:</p><pre><code class="nohighlight hljs">ssh -i &quot;ssh-key-for-instance.pem&quot; user@123.123.123.123</code></pre><p>Install Julia if not present. Then make the clone:</p><pre><code class="nohighlight hljs">git clone github.com/user/MyGenieApp
cd MyGenieAp</code></pre><p>Install the app as any other Julia project:</p><pre><code class="nohighlight hljs">julia
] activate .
Pkg&gt; instantiate
exit()</code></pre><p>In order to launch the app and exit the console without shutting down the app, we will launch it from a new screen:</p><pre><code class="nohighlight hljs">screen -S genie</code></pre><p>Then set the GENIE_ENV environment variable to <code>prod</code>:</p><pre><code class="nohighlight hljs">export GENIE_ENV=prod</code></pre><p>Launch the app:</p><pre><code class="nohighlight hljs">./bin/server</code></pre><p>Now the Genie app should be running on the server and be accessible at the following address: <code>123.123.123.123:8000</code> (if port 8000 has been open - see instance security settings). Note that only raw content will be returned as the <code>prod</code> Genie environments doesn&#39;t serve the static content (see the <code>Settings</code> option <code>server_handle_static_file</code> in <code>config/env/prod.jl</code>). Static content will be handled by nginx. We can now detach from the <code>genie</code> screen used to launch the app (Ctl+A d).</p><h2 id="Install-and-configure-nginx-server"><a class="docs-heading-anchor" href="#Install-and-configure-nginx-server">Install and configure nginx server</a><a id="Install-and-configure-nginx-server-1"></a><a class="docs-heading-anchor-permalink" href="#Install-and-configure-nginx-server" title="Permalink"></a></h2><p>Nginx server will be used as a reverse proxy. It will listen requests made on port 80 (HTTP) and redirect traffic to the Genie app running on port 8000 (default Genie setting that can be changed).</p><p>Nginx will also be used to serve the app static files, that is, the content under the <code>./public</code> folder.</p><p>Finally, it can as well handle HTTPS requests, which will also be redirected to the Genie app listening on port 8000.</p><p>Installation:</p><pre><code class="nohighlight hljs">sudo apt-get update
sudo apt-get install nginx
sudo systemctl start nginx
sudo systemctl enable nginx</code></pre><p>A configuration file then needs to to be created to indicate on which port to listen (80 for HTTP) and to which port to redirect the traffic (8000 for default Genie config).</p><p>Config is created in folder <code>/etc/nginx/sites-available</code>: <code>sudo nano my-genie-app</code>. Put the following content in <code>my-genie-app</code>:</p><pre><code class="nohighlight hljs">server {
  listen 80;
  listen [::]:80;

  server_name   test.com;
  root          /home/ubuntu/MyGenieApp/public;
  index         welcome.html;

  location / {
      proxy_pass http://localhost:8000/;
  }

  location /css/genie {
      proxy_pass http://localhost:8000/;
  }
  location /img/genie {
      proxy_pass http://localhost:8000/;
  }
  location /js/genie {
      proxy_pass http://localhost:8000/;
  }
}</code></pre><ul><li><code>server_name</code>: refers to the web domain to be used. It can be put to an arbitrary name if the app is only to be served directly from the server public IP.</li><li><code>root</code>: points to the <code>public</code> subfolder where the genie app was cloned.</li><li><code>index</code>: refers to the site index (the landing page).</li><li>The various <code>location</code> following the initial proxy to the genie app are used to indicate static content folders to be served by nginx. These are needed when the <code>server_handle_static_file</code> is set to <code>false</code> in the Genie app settings.</li></ul><p>To make that config effective, it needs to be present in <code>sites-enabled</code>. The <code>default</code> config can be removed.</p><pre><code class="nohighlight hljs">sudo ln -s /etc/nginx/sites-available/my-genie-app /etc/nginx/sites-enabled/my-genie-app</code></pre><p>Then restart the server to make changes effective:</p><pre><code class="nohighlight hljs">sudo systemctl restart nginx</code></pre><h2 id="Enable-HTTPS"><a class="docs-heading-anchor" href="#Enable-HTTPS">Enable HTTPS</a><a id="Enable-HTTPS-1"></a><a class="docs-heading-anchor-permalink" href="#Enable-HTTPS" title="Permalink"></a></h2><p>To enable HTTP, a site-certificate will be needed for the domain on which the site will be served. A practical approach is to use the utilities provided by <a href="https://certbot.eff.org/">certbot</a>.</p><p>Following provived instructions for nginx on Ubuntu 20.04:</p><pre><code class="nohighlight hljs">sudo snap install core; sudo snap refresh core
sudo snap install --classic certbot
sudo ln -s /snap/bin/certbot /usr/bin/certbot</code></pre><p>Then, using certbot utility, a certificate will be generated and appropriate modification to nginx config will be brought to handle support for HTTPS:</p><pre><code class="nohighlight hljs">sudo certbot --nginx</code></pre><p>Note that this steps will check for ownernship of the <code>test.com</code> domain mentionned in the nginx config file. For that validation to succeed, it requires to have the <code>A</code> record for the domain set to <code>123.123.123.123</code>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="91--Deploying_Genie_Docker_Apps_on_Heroku.html">« Deploying to Heroku with Docker</a><a class="docs-footer-nextpage" href="../api/app.html">App »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.12 on <span class="colophon-date" title="Monday 21 February 2022 17:03">Monday 21 February 2022</span>. Using Julia version 1.7.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
